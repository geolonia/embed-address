!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o={geolocationButtonLabel:"現在地から住所を入力",prefectureLabel:"都道府県",cityLabel:"市区町村",smallAreaLabel:"大字町丁目",otherAddressLabel:"その他の住所"},a=(e,t,n,o)=>new Promise(a=>{t.forEach(t=>{const a=document.createElement("option");a.value=t[n],a.innerText=t[o],a.className="geolonia_address_"+e.name,e.appendChild(a)}),e.disabled=!1,a()}),l=(e,t,n)=>new Promise(o=>{t.forEach(t=>{const o=document.createElement("option");o.value=t[n],e.appendChild(o)}),o()}),r=e=>new Promise(t=>{[...e.children].forEach(e=>{const t=e;"-"!==t.innerHTML?t.remove():t.selected=!0}),t()}),i=(e,t=o)=>new Promise(n=>{const a=Object.assign(Object.assign({},o),t);e.className+=(e.className?" ":"")+"geolonia_address_wrap";e.innerHTML+=`\n    <button type="button" id="geolonia-reverse-geocode-button">${a.geolocationButtonLabel}</button>\n    <div class="geolonia_pref">\n      <label class="geolonia_pref_label" for="geolonia-pref-code">${a.prefectureLabel}</label>\n      <select class="geolonia_pref_select" id="geolonia-pref-code" disabled>\n        <option selected disabled>-</option>\n      </select>\n      <input type="hidden" id="geolonia-prefecture-name" name="prefecture" />\n    </div>\n\n    <div class="geolonia_city">\n      <label class="geolonia_city_label" for="geolonia-city-code">${a.cityLabel}</label>\n      <select class="geolonia_city_select" id="geolonia-city-code" disabled>\n            <option selected disabled>-</option>\n      </select>\n      <input type="hidden" id="geolonia-city-name" name="city" />\n    </div>\n\n    <div class="geolonia_small_area">\n      <label class="geolonia_small_area_label" for="geolonia-small-area">${a.smallAreaLabel}</label>\n      <input class="geolonia_small_area_input" type="text" id="geolonia-small-area" list="geolonia-small-area-datalist" name="small-area"></select>\n      <datalist id="geolonia-small-area-datalist"></datalist>\n      <input type="hidden" id=geolonia-small-area-is-exception name="is-exception" />\n    </div>\n\n    <div class="geolonia_other_address">\n      <label class="geolonia_other_address_label" for="geolonia-other-address">${a.otherAddressLabel}</label>\n      <input class="geolonia_ither_address_input" type="text" id="geolonia-other-address" name="other-address"></select>\n    </div>\n\n    <div class="geolonia_error"><span id="geolonia-error-message" /></div>\n  `;const l=document.getElementById("geolonia-reverse-geocode-button"),r=document.querySelector("#geolonia-pref-code"),i=document.querySelector("#geolonia-prefecture-name"),s=document.querySelector("#geolonia-city-code"),d=document.querySelector("#geolonia-city-name"),c=document.querySelector("#geolonia-small-area"),u=document.querySelector("#geolonia-small-area-datalist"),g=document.querySelector("#geolonia-small-area-is-exception"),m=document.querySelector("#geolonia-other-address"),f=document.querySelector("#geolonia-error-message"),p=e.closest("form");r.addEventListener("change",e=>{if(e.target instanceof HTMLSelectElement){f.innerText="";const t=e.target.value,n=[...document.querySelectorAll("#geolonia-pref-code option")].find(e=>e.value===t);n&&(i.value=n.innerText)}}),s.addEventListener("change",e=>{if(e.target instanceof HTMLSelectElement){f.innerText="";const t=e.target.value,n=[...document.querySelectorAll("#geolonia-city-code option")].find(e=>e.value===t);n&&(d.value=n.innerText)}}),c.addEventListener("change",e=>{if(e.target instanceof HTMLInputElement){f.innerText="";const t=e.target.value,n=[...document.querySelectorAll("#geolonia-small-area-datalist option")].find(e=>e.value===t);g.value=n?"false":"true"}}),m.addEventListener("change",e=>{f.innerText=""}),n({buttonGeolocation:l,selectPrefCode:r,inputPrefName:i,selectCityCode:s,inputCityName:d,inputSmallArea:c,datalistSmallArea:u,inputIsSmallAreaException:g,spanErrorMessage:f,parentalForm:p})});var s=function(e,t,n,o){return new(n||(n=Promise))((function(a,l){function r(e){try{s(o.next(e))}catch(e){l(e)}}function i(e){try{s(o.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}s((o=o.apply(e,t||[])).next())}))};const d=e=>s(void 0,void 0,void 0,(function*(){try{return yield fetch("https://cdn.geolonia.com/address/"+e).then(e=>{if(e.status>299)throw console.error(e),new Error("request error");return e.json()})}catch(e){return null}})),c=e=>s(void 0,void 0,void 0,(function*(){let t,n,o;if(t=e instanceof HTMLElement?e:document.getElementById(e),!t)throw new Error("no target found.");let c="",u="";const[{buttonGeolocation:g,selectPrefCode:m,inputPrefName:f,selectCityCode:p,inputCityName:v,inputSmallArea:y,datalistSmallArea:b,inputIsSmallAreaException:h,spanErrorMessage:_,parentalForm:E},S]=yield Promise.all([i(t),d("japan.json")]);S?(g.addEventListener("click",()=>s(void 0,void 0,void 0,(function*(){try{const e=yield new Promise((e,t)=>{window.navigator.geolocation.getCurrentPosition(t=>{const{latitude:n,longitude:o}=t.coords;e({lat:n,lng:o})},e=>t(e))});n=e.lat,o=e.lng}catch(e){return console.error(e),void(_.innerText="現在位置から住所を取得できませんでした。")}const e=yield((e,t)=>s(void 0,void 0,void 0,(function*(){try{return yield fetch(`https://api.geolonia.com/dev/reverseGeocode?lng=${e}&lat=${t}`).then(e=>{if(e.status>299)throw console.error(e),new Error("request error");return e.json()})}catch(e){return null}})))(o,n);if(!e)return void(_.innerText="何かのエラーです。現在位置から住所を取得できませんでした。");_.innerText="";const{PREF:t,CITY:i,S_NAME:g}=e;c=t,u=t+i;const[E,x]=yield Promise.all([d(`japan/${c}.json`),d(`japan/${c}/${u}.json`)]);if(!(E&&x||S))return void(_.innerText="何かのエラーです。住所データを取得できませんでした。");const L=S.find(e=>e.都道府県コード===c),T=E.find(e=>e.市区町村コード===u);L&&(f.value=L.都道府県名),T&&(v.value=T.市区町村名),yield Promise.all([r(p),r(b)]),yield Promise.all([a(p,E,"市区町村コード","市区町村名"),l(b,x,"大字町丁目名")]),m.value=c,p.value=u,y.value=g||"",h.value=x.find(e=>e.大字町丁目名===g)?"false":"true"}))),yield a(m,S,"都道府県コード","都道府県名"),m.disabled=!1,m.addEventListener("change",e=>s(void 0,void 0,void 0,(function*(){if(e.target instanceof HTMLSelectElement){c=e.target.value;const t=yield d(`japan/${c}.json`);if(!t&&!S)return void(_.innerText="何かのエラーです。住所データを取得できませんでした。");yield Promise.all([r(p),r(b)]),yield a(p,t,"市区町村コード","市区町村名"),p.disabled=!1}}))),p.addEventListener("change",e=>s(void 0,void 0,void 0,(function*(){if(e.target instanceof HTMLSelectElement){u=e.target.value;const t=yield d(`japan/${c}/${u}.json`);if(!t&&!S)return void(_.innerText="何かのエラーです。住所データを取得できませんでした。");yield r(b),yield l(b,t,"大字町丁目名")}}))),E&&E.addEventListener("submit",e=>{if(e.target instanceof HTMLFormElement&&n&&o){const t=new FormData(e.target),a=new FormData;a.set("prefecture",t.get("prefecture")),a.set("city",t.get("city")),a.set("small-area",t.get("small-area")),a.set("other-address",t.get("other-address")),a.set("is-exception",t.get("is-exception")),a.set("lat",n.toString()),a.set("lng",o.toString()),fetch("path/to/geolonia/server",{method:"POST",body:a})}})):_.innerText="何かのエラーです。住所データを取得できませんでした。"})),u=document.getElementById("address");u&&c(u),window.geolonia||(window.geolonia={}),window.geolonia.address=c}]);